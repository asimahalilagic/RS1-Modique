<div class="container-fluid bg-secondary mb-5">
  <div class="d-flex flex-column align-items-center justify-content-center" style="min-height: 300px">
    <h1 class="font-weight-semi-bold text-uppercase mb-3">Detalji proizvoda</h1>
    <div class="d-inline-flex">
      <p class="m-0"><a routerLink="/" class="text-dark">Početna</a></p>
      <p class="m-0 px-2">-</p>
      <p class="m-0">Detalji proizvoda</p>
    </div>
  </div>
</div>

<div class="container-fluid pt-3 pb-5" *ngIf="!isLoading && product">
  <div class="container py-3">
    <div class="row">
      <div class="col-md-6 mb-4 mb-md-0">
        <div class="carousel-custom position-relative">
          <button class="arrow left" (click)="prevImage()" type="button">&#10094;</button>
          <div class="slideshow-container">
            <img 
              *ngFor="let img of getCurrentImages(); let i = index" 
              [src]="img.startsWith('http') || img.startsWith('/') ? img : 'assets/img/' + img" 
              [alt]="product.name"
              [class.active]="i === currentImageIndex"
              class="img-fluid mb-3"
              (click)="openImageZoom(img.startsWith('http') || img.startsWith('/') ? img : 'assets/img/' + img)"
              style="cursor: pointer;">
          </div>
          <button class="arrow right" (click)="nextImage()" type="button">&#10095;</button>
        </div>
      </div>

      <div class="col-md-6">
        <h2>{{ product.name }}</h2>
        <p class="text-muted" *ngIf="product.brandName">Brend: {{ product.brandName }}</p>
        <p *ngIf="product.description">{{ product.description }}</p>

        <h4 class="text-danger">{{ product.price.toFixed(2) }} KM</h4>

        <div class="mb-3">
          <label for="velicina"><strong>Veličina:</strong></label>
          <select id="velicina" class="form-control w-50" [(ngModel)]="selectedSize">
            <option *ngFor="let size of sizes" [value]="size">{{ size }}</option>
          </select>
        </div>

        <div class="mb-3">
          <label><strong>Boja:</strong></label><br />
          <span 
            *ngFor="let color of colors" 
            class="color-chip" 
            [class]="'color-chip ' + color.class"
            [class.is-active]="selectedColor === color.value"
            (click)="changeColor(color.value)">
            {{ color.label }}
          </span>
        </div>

        <div class="d-flex align-items-center mb-3">
          <div class="input-group quantity mr-3" style="width: 130px;">
            <div class="input-group-btn">
              <button class="btn btn-primary btn-minus" type="button" (click)="decreaseQuantity()">
                <i class="fa fa-minus"></i>
              </button>
            </div>
            <input type="text" class="form-control bg-secondary text-center" [value]="quantity" readonly />
            <div class="input-group-btn">
              <button class="btn btn-primary btn-plus" type="button" (click)="increaseQuantity()">
                <i class="fa fa-plus"></i>
              </button>
            </div>
          </div>
          <button class="btn btn-primary px-3" (click)="addToCart()" type="button">
            <i class="fa fa-shopping-cart mr-1"></i> Dodaj u košaricu
          </button>
        </div>

        <div class="d-flex pt-2">
          <p class="text-dark font-weight-medium mb-0 mr-2">Podijeli na:</p>
          <div class="d-inline-flex">
            <a class="text-dark px-2" href="#"><i class="fab fa-facebook-f"></i></a>
            <a class="text-dark px-2" href="#"><i class="fab fa-twitter"></i></a>
            <a class="text-dark px-2" href="#"><i class="fab fa-linkedin-in"></i></a>
            <a class="text-dark px-2" href="#"><i class="fab fa-pinterest"></i></a>
          </div>
        </div>
      </div>
    </div>

    <div class="row px-xl-3 mt-5">
      <div class="col">
        <div class="nav nav-tabs justify-content-center border-secondary mb-4">
          <a 
            class="nav-item nav-link" 
            [class.active]="activeTab === 'opis'"
            (click)="setActiveTab('opis'); $event.preventDefault()" 
            href="#tab-opis">
            Opis proizvoda
          </a>
          <a 
            class="nav-item nav-link" 
            [class.active]="activeTab === 'info'"
            (click)="setActiveTab('info'); $event.preventDefault()" 
            href="#tab-info">
            Dodatne informacije
          </a>
          <a 
            class="nav-item nav-link" 
            [class.active]="activeTab === 'rec'"
            (click)="setActiveTab('rec'); $event.preventDefault()" 
            href="#tab-rec">
            Recenzije (1)
          </a>
        </div>

        <div class="tab-content">
          <div class="tab-pane" [class.show]="activeTab === 'opis'" [class.active]="activeTab === 'opis'" id="tab-opis">
            <h4 class="mb-3">Opis proizvoda</h4>
            <p *ngIf="product.description">{{ product.description }}</p>
            <p *ngIf="!product.description">Nema dostupnog opisa proizvoda.</p>
          </div>

          <div class="tab-pane" [class.show]="activeTab === 'info'" [class.active]="activeTab === 'info'" id="tab-info">
            <h4 class="mb-3">Dodatne informacije</h4>
            <p class="mb-1" *ngIf="product.categoryName"><strong>Kategorija:</strong> {{ product.categoryName }}</p>
            <p class="mb-1" *ngIf="product.brandName"><strong>Brend:</strong> {{ product.brandName }}</p>
            <p class="mb-1"><strong>Cijena:</strong> {{ product.price.toFixed(2) }} KM</p>
          </div>

          <div class="tab-pane" [class.show]="activeTab === 'rec'" [class.active]="activeTab === 'rec'" id="tab-rec">
            <div class="row">
              <div class="col-md-6">
                <h4 class="mb-4">1 recenzija za {{ product.name }}</h4>
                <div class="media mb-4">
                  <img src="assets/img/user.jpg" alt="User" class="img-fluid mr-3 mt-1" style="width: 45px;" />
                  <div class="media-body">
                    <h6>John Doe <small> - <i>01 Jan 2025</i></small></h6>
                    <div class="text-primary mb-2">
                      <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i><i class="far fa-star"></i>
                    </div>
                    <p>Odličan proizvod — visok kvalitet i brza isporuka.</p>
                  </div>
                </div>
              </div>

              <div class="col-md-6">
                <h4 class="mb-4">Ostavite recenziju</h4>
                <small>Vaša e-mail adresa neće biti objavljena. Obavezna polja su označena *.</small>
                <div class="d-flex my-3">
                  <p class="mb-0 mr-2">Vaša ocjena * :</p>
                  <div class="text-primary">
                    <i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i><i class="far fa-star"></i>
                  </div>
                </div>
                <form>
                  <div class="form-group">
                    <label for="message">Vaša recenzija *</label>
                    <textarea id="message" cols="30" rows="5" class="form-control"></textarea>
                  </div>
                  <div class="form-group">
                    <label for="name">Vaše ime *</label>
                    <input type="text" class="form-control" id="name" />
                  </div>
                  <div class="form-group">
                    <label for="email">Vaš E-mail *</label>
                    <input type="email" class="form-control" id="email" />
                  </div>
                  <div class="form-group mb-0">
                    <input type="submit" value="Ostavite recenziju" class="btn btn-primary px-3" />
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div class="container-fluid py-5" *ngIf="relatedProducts.length > 0 && !isLoading">
  <div class="text-center mb-4">
    <h2 class="section-title px-5"><span class="px-2">Možda će Vam se svidjeti</span></h2>
  </div>
  <div class="row px-xl-5">
    <div class="col-lg-3 col-md-6 col-sm-12 pb-1" *ngFor="let product of relatedProducts">
      <app-product-card 
        [product]="product"
        [isFavorite]="isFavorite(product.productId)"
        (addToCart)="onAddToCart($event)"
        (toggleFavorite)="onToggleFavorite($event)">
      </app-product-card>
    </div>
  </div>
</div>

<div class="container-fluid text-center py-5" *ngIf="isLoading">
  <div class="spinner-border text-primary" role="status">
    <span class="sr-only">Učitavanje...</span>
  </div>
</div>

<div class="container-fluid text-center py-5" *ngIf="!isLoading && !product">
  <p class="text-muted">Proizvod nije pronađen.</p>
  <a routerLink="/shop" class="btn btn-primary">Nazad na trgovinu</a>
</div>

<div class="image-zoom-modal" *ngIf="showZoomModal" (click)="closeImageZoom()">
  <div class="zoom-modal-content" (click)="$event.stopPropagation()">
    <button class="zoom-close" (click)="closeImageZoom()" type="button">&times;</button>
    <img [src]="zoomedImage" [alt]="product?.name" class="zoomed-image">
  </div>
</div>
